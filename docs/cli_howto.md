[InstanceBuilder.py]: https://github.com/rackerlabs/trial-by-combat/blob/master/TBC/Rackspace/InstanceBuilder.py
[benchmarks]: https://github.com/rackerlabs/trial-by-combat/tree/master/TBC/benchmarks

# Using Trial By Combat

For a description of all commands, run

~~~~
trial-by-combat --help
~~~~

## Starting a Slave

Before running a benchmark you must start up all of the slave nodes.

On a VM, run

~~~~
trial-by-combat --slave --daemonize --port 9999 --path /where/to/store/log/files
~~~~
 
The following arguments are optional:

* **--daemonize:** if you don't include this then the slave will print information directly to the terminal
* **--port:** the default port is 9999
* **--path:** the default path is ./

### Starting slaves automatically

If the argument **â€“bootstrap** is passed to the Trial By Combat master then it will automatically start all needed slave instances.

## Loading a Benchmark

There are two phases to the benchmark: loading and running.  In the loading phase tables are created and populated.  In running phase a workload is applied and its performance is measured.

### Loading
A benchmark only needs to be loaded once for multiple benchmark runs.  It may optionally be loaded multiple times if a clean database is desired.  Use the following command to load the benchmark.

~~~~
trial_by_combat.py --master --bootstrap --load --shutdown --port 9999 --config config1.yaml config2.yaml ... configN.yaml --path /where/to/store/log/files
~~~~

The following arguments are optional:

* **--bootstrap:** automatically start up the slave nodes (these actually do the loading)
* **--shutdown:** shutdown the slave processes after they are finished being used
* **--port:** the default port is 9999
* **--path:** the default path is ./

A node with the **--master** flag expects several configuration files.  These files are described below.

### Configuration files

#### Database configuration (.yaml)

(Note: if you are using Rackspace infrastructure then this file can be automatically generated by [InstanceBuilder.py])

Example MySQL configuration

~~~~
interface:
    id: MySQL
    data:
        url: blah_blah_blah.rackspaceclouddb.com
        port: 3306
        user: benchmark
        password: database_password
        database: benchmark
        debug_queries: False
        debug_responses: False
~~~~

Example Redis configuration

~~~~
interface:
    id: redis
    data:
        url: blah_blah_blah.rackspaceclouddb.com
        port: 6379
        database: 0
        password: database_password
        client: StrictRedis
        debug: False
~~~~

#### Node configuration (.yaml)

(Note: if you are using Rackspace infrastructure then this file is automatically generated by [InstanceBuilder.py])

~~~~
nodes:
- host: ip_address_1
  id: node_id
  password: node_root_password
  path: /root/trial-by-combat
  port: 9999
  user: root
- host: ip_address_2
  id: node_id
  password: node_root_password
  path: /root/trial-by-combat
  port: 9999
  user: root
~~~~

## Running a Benchmark

Below is an example command that runs a benchmark.

~~~~
trial_by_combat.py --master --bootstrap --run --shutdown --port 9999 --config config1.yaml config2.yaml ... configN.yaml --path /where/to/store/log/files
~~~~

The following arguments are optional:

* **--bootstrap:** automatically start up the slave nodes (these actually do the loading)
* **--shutdown:** shutdown the slave processes after they are finished being used
* **--port:** the default port is 9999
* **--path:** the default path is ./

A node with the **--master** flag expects several configuration files.  These files are described below.

### Configuration files

#### Database configuration & Node configuration (.yaml)

These configuration files are identical to those required by the **--load** flag.

#### Benchmark configuration (.yaml)

Each benchmark has its own configuration file format.  See the example configuration files included in the [benchmarks] directory.

#### History configuration (.yaml)

This file is optional.  If included then Trial By Combat will store benchmark data in a database for later comparison.

~~~~
history:
    benchmark_id: name_of_benchmark
    interface_id: MySQL
    interface_data:
        url: url_to_mysql_instance.rackspaceclouddb.com
        port: 3306
        user: benchmark
        password: database_password
        database: benchmark
        debug_queries: False
        debug_responses: False
~~~~